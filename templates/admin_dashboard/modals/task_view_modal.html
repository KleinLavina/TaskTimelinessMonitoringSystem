<!-- View Task Modal -->
<div class="modal fade" id="viewTaskModal" tabindex="-1" aria-labelledby="viewTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title d-flex align-items-center" id="viewTaskModalLabel">
                    <div class="task-modal-icon me-3">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div>
                        <span id="view_task_title" class="fw-bold"></span>
                        <div class="small opacity-75 mt-1">
                            <span id="view_task_id" class="badge bg-white text-dark">#000</span>
                            <span class="ms-2" id="view_task_date_info">Created on -</span>
                        </div>
                    </div>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <div class="row">
                    <!-- Left Column - Main Content -->
                    <div class="col-lg-8">
                        <!-- Task Description Section -->
                        <div class="card mb-4 border-0 shadow-sm">
                            <div class="card-header bg-light py-3">
                                <h6 class="mb-0 d-flex align-items-center">
                                    <i class="fas fa-align-left text-primary me-2"></i>
                                    Task Description
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="view_task_description_content" class="task-description-content">
                                    <p id="view_task_description" class="mb-0"></p>
                                </div>
                                <div id="view_task_no_description" class="text-center py-4 d-none">
                                    <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
                                    <p class="text-muted mb-0">No description provided for this task</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Task Specifications -->
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body text-center p-4">
                                        <div class="spec-icon mb-3">
                                            <i class="fas fa-calendar-alt fa-2x text-primary"></i>
                                        </div>
                                        <h3 class="text-primary fw-bold mb-2" id="view_task_duration">0</h3>
                                        <p class="text-muted mb-0">Standard Duration</p>
                                        <small class="text-muted">Days</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body text-center p-4">
                                        <div class="spec-icon mb-3">
                                            <i class="fas fa-flag fa-2x" id="view_task_priority_icon"></i>
                                        </div>
                                        <div class="mb-3">
                                            <span class="badge fs-6 px-3 py-2" id="view_task_priority">Medium</span>
                                        </div>
                                        <p class="text-muted mb-0" id="view_priority_description"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column - Task Metadata -->
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-light py-3">
                                <h6 class="mb-0 d-flex align-items-center">
                                    <i class="fas fa-info-circle text-primary me-2"></i>
                                    Task Information
                                </h6>
                            </div>
                            <div class="card-body">
                                <!-- Status Information -->
                                <div class="info-item mb-4">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="info-icon bg-primary text-white rounded-circle p-2 me-3">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block">Completion Rate</small>
                                            <div class="d-flex align-items-center">
                                                <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                    <div class="progress-bar bg-success" id="view_completion_progress" 
                                                         role="progressbar" style="width: 75%"></div>
                                                </div>
                                                <strong id="view_completion_rate">75%</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Timeline Information -->
                                <div class="info-item mb-4">
                                    <h6 class="text-muted mb-3">
                                        <i class="fas fa-history me-2"></i>Timeline
                                    </h6>
                                    <div class="timeline">
                                        <div class="timeline-item mb-3">
                                            <div class="d-flex align-items-start">
                                                <div class="timeline-icon bg-success text-white rounded-circle p-2 me-3">
                                                    <i class="fas fa-plus"></i>
                                                </div>
                                                <div>
                                                    <small class="text-muted d-block">Created</small>
                                                    <strong id="view_task_created">-</strong>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="timeline-item">
                                            <div class="d-flex align-items-start">
                                                <div class="timeline-icon bg-warning text-white rounded-circle p-2 me-3">
                                                    <i class="fas fa-edit"></i>
                                                </div>
                                                <div>
                                                    <small class="text-muted d-block">Last Updated</small>
                                                    <strong id="view_task_updated">-</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Statistics -->
                                <div class="info-item">
                                    <h6 class="text-muted mb-3">
                                        <i class="fas fa-chart-bar me-2"></i>Statistics
                                    </h6>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <div class="stat-card text-center p-2 bg-light rounded">
                                                <div class="stat-number text-primary fw-bold mb-1" id="view_assignments_count">0</div>
                                                <small class="text-muted">Total Assignments</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="stat-card text-center p-2 bg-light rounded">
                                                <div class="stat-number text-success fw-bold mb-1" id="view_completed_assignments">0</div>
                                                <small class="text-muted">Completed</small>
                                            </div>
                                        </div>
                                        <div class="col-6 mt-2">
                                            <div class="stat-card text-center p-2 bg-light rounded">
                                                <div class="stat-number text-warning fw-bold mb-1" id="view_inprogress_assignments">0</div>
                                                <small class="text-muted">In Progress</small>
                                            </div>
                                        </div>
                                        <div class="col-6 mt-2">
                                            <div class="stat-card text-center p-2 bg-light rounded">
                                                <div class="stat-number text-danger fw-bold mb-1" id="view_overdue_assignments">0</div>
                                                <small class="text-muted">Overdue</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Task Guidelines -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-light py-3">
                                <h6 class="mb-0 d-flex align-items-center">
                                    <i class="fas fa-clipboard-check text-primary me-2"></i>
                                    Task Guidelines & Requirements
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="guideline-item">
                                            <div class="d-flex">
                                                <div class="guideline-icon text-success me-3">
                                                    <i class="fas fa-check-circle fa-lg"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-2">Expected Output</h6>
                                                    <p class="text-muted small mb-0" id="view_expected_output">
                                                        Complete all task requirements as specified in the description with attention to detail.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="guideline-item">
                                            <div class="d-flex">
                                                <div class="guideline-icon text-warning me-3">
                                                    <i class="fas fa-exclamation-triangle fa-lg"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-2">Quality Standards</h6>
                                                    <p class="text-muted small mb-0" id="view_quality_standards">
                                                        Must meet department quality assurance requirements before submission.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="guideline-item">
                                            <div class="d-flex">
                                                <div class="guideline-icon text-info me-3">
                                                    <i class="fas fa-clock fa-lg"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-2">Time Management</h6>
                                                    <p class="text-muted small mb-0" id="view_time_management">
                                                        Complete within standard duration of <span id="view_duration_days">0</span> days for optimal performance.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="guideline-item">
                                            <div class="d-flex">
                                                <div class="guideline-icon text-primary me-3">
                                                    <i class="fas fa-users fa-lg"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-2">Team Collaboration</h6>
                                                    <p class="text-muted small mb-0" id="view_collaboration">
                                                        Coordinate with team members and report progress regularly.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Close
                </button>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" id="editFromViewBtn">
                        <i class="fas fa-edit me-2"></i>Edit Task
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="assignFromViewBtn">
                        <i class="fas fa-user-check me-2"></i>Assign Task
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* View Task Modal Styles */
.task-modal-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.modal-header.bg-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border-bottom: none;
}

.task-description-content {
    min-height: 100px;
    line-height: 1.8;
    color: #333;
    white-space: pre-line;
}

.spec-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #f6f9ff 0%, #eef2ff 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.info-icon, .timeline-icon {
    width: 40px;
    height: 40px;
    flex-shrink: 0;
}

.timeline {
    position: relative;
    padding-left: 15px;
}

.timeline:before {
    content: '';
    position: absolute;
    left: 25px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #e9ecef;
}

.guideline-item {
    padding: 1rem;
    border-radius: 8px;
    background: #f8f9fa;
    transition: transform 0.2s;
}

.guideline-item:hover {
    transform: translateY(-2px);
    background: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.guideline-icon {
    margin-top: 4px;
}

.stat-card {
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.progress {
    border-radius: 10px;
}

.progress-bar {
    border-radius: 10px;
}

/* Animation for modal */
.modal.fade .modal-content {
    transform: translateY(-50px);
    opacity: 0;
    transition: all 0.3s ease;
}

.modal.show .modal-content {
    transform: translateY(0);
    opacity: 1;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .spec-icon {
        width: 50px;
        height: 50px;
    }
    
    .info-icon, .timeline-icon {
        width: 36px;
        height: 36px;
    }
    
    .modal-dialog {
        margin: 1rem;
    }
}
</style>

<script>
// View Modal JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // ========== VIEW BUTTON FUNCTIONALITY ==========
    document.querySelectorAll('.view-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Get task data from data attributes
            const taskId = this.getAttribute('data-id');
            const taskTitle = this.getAttribute('data-title');
            const taskDescription = this.getAttribute('data-description');
            const taskDuration = this.getAttribute('data-duration');
            const taskPriority = this.getAttribute('data-priority');
            
            // Populate modal with task data
            document.getElementById('view_task_title').textContent = taskTitle;
            document.getElementById('view_task_id').textContent = `#${String(taskId).padStart(3, '0')}`;
            
            // Handle description
            const descriptionElement = document.getElementById('view_task_description');
            const noDescriptionElement = document.getElementById('view_task_no_description');
            
            if (taskDescription && taskDescription !== 'No description') {
                descriptionElement.textContent = taskDescription;
                descriptionElement.style.display = 'block';
                noDescriptionElement.classList.add('d-none');
            } else {
                descriptionElement.style.display = 'none';
                noDescriptionElement.classList.remove('d-none');
            }
            
            // Duration
            document.getElementById('view_task_duration').textContent = taskDuration;
            document.getElementById('view_duration_days').textContent = taskDuration;
            
            // Priority handling
            setPriorityDisplay(taskPriority);
            
            // Set dates (placeholder - you should pass real dates from backend)
            setTaskDates();
            
            // Set statistics (placeholder - you should pass real stats from backend)
            setTaskStatistics(taskId);
            
            // Store task data for Edit button
            const viewModal = document.getElementById('viewTaskModal');
            viewModal.setAttribute('data-task-id', taskId);
            viewModal.setAttribute('data-task-title', taskTitle);
            viewModal.setAttribute('data-task-description', taskDescription || '');
            viewModal.setAttribute('data-task-duration', taskDuration);
            viewModal.setAttribute('data-task-priority', taskPriority);
        });
    });
    
    // ========== PRIORITY DISPLAY FUNCTION ==========
    function setPriorityDisplay(priority) {
        const priorityBadge = document.getElementById('view_task_priority');
        const priorityIcon = document.getElementById('view_task_priority_icon');
        const priorityDescription = document.getElementById('view_priority_description');
        
        let badgeClass = '';
        let iconClass = '';
        let description = '';
        let colorClass = '';
        
        switch(priority) {
            case 'high':
                badgeClass = 'bg-danger';
                iconClass = 'fas fa-exclamation-circle';
                description = 'Critical priority - Requires immediate attention';
                colorClass = 'text-danger';
                break;
            case 'medium':
                badgeClass = 'bg-warning';
                iconClass = 'fas fa-exclamation-triangle';
                description = 'Medium priority - Should be completed soon';
                colorClass = 'text-warning';
                break;
            case 'low':
                badgeClass = 'bg-success';
                iconClass = 'fas fa-check-circle';
                description = 'Low priority - Can be scheduled as needed';
                colorClass = 'text-success';
                break;
            default:
                badgeClass = 'bg-secondary';
                iconClass = 'fas fa-question-circle';
                description = 'Priority not specified';
                colorClass = 'text-secondary';
        }
        
        priorityBadge.textContent = priority.charAt(0).toUpperCase() + priority.slice(1);
        priorityBadge.className = `badge fs-6 px-3 py-2 ${badgeClass}`;
        priorityIcon.className = `${iconClass} fa-2x ${colorClass}`;
        priorityDescription.textContent = description;
    }
    
    // ========== SET TASK DATES (PLACEHOLDER) ==========
    function setTaskDates() {
        const now = new Date();
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        
        // Created date (30 days ago for demo)
        const createdDate = new Date();
        createdDate.setDate(now.getDate() - Math.floor(Math.random() * 30) + 5);
        document.getElementById('view_task_created').textContent = createdDate.toLocaleDateString('en-US', options);
        
        // Updated date (within last 7 days)
        const updatedDate = new Date();
        updatedDate.setDate(now.getDate() - Math.floor(Math.random() * 7));
        document.getElementById('view_task_updated').textContent = updatedDate.toLocaleDateString('en-US', options);
        
        // Date info in header
        document.getElementById('view_task_date_info').textContent = 
            `Created on ${createdDate.toLocaleDateString('en-US', options)}`;
    }
    
    // ========== SET TASK STATISTICS (PLACEHOLDER) ==========
    function setTaskStatistics(taskId) {
        // Generate random statistics for demo
        const totalAssignments = Math.floor(Math.random() * 15) + 1;
        const completedAssignments = Math.floor(totalAssignments * (0.6 + Math.random() * 0.3));
        const inProgressAssignments = Math.floor((totalAssignments - completedAssignments) * 0.7);
        const overdueAssignments = totalAssignments - completedAssignments - inProgressAssignments;
        const completionRate = Math.round((completedAssignments / totalAssignments) * 100);
        
        // Update DOM elements
        document.getElementById('view_assignments_count').textContent = totalAssignments;
        document.getElementById('view_completed_assignments').textContent = completedAssignments;
        document.getElementById('view_inprogress_assignments').textContent = inProgressAssignments;
        document.getElementById('view_overdue_assignments').textContent = overdueAssignments;
        document.getElementById('view_completion_rate').textContent = `${completionRate}%`;
        document.getElementById('view_completion_progress').style.width = `${completionRate}%`;
        
        // Set progress bar color based on completion rate
        const progressBar = document.getElementById('view_completion_progress');
        if (completionRate >= 80) {
            progressBar.className = 'progress-bar bg-success';
        } else if (completionRate >= 50) {
            progressBar.className = 'progress-bar bg-warning';
        } else {
            progressBar.className = 'progress-bar bg-danger';
        }
    }
    
    // ========== EDIT FROM VIEW BUTTON ==========
    document.getElementById('editFromViewBtn').addEventListener('click', function() {
        const viewModal = document.getElementById('viewTaskModal');
        const taskId = viewModal.getAttribute('data-task-id');
        
        // Close view modal
        const viewModalInstance = bootstrap.Modal.getInstance(viewModal);
        viewModalInstance.hide();
        
        // Find the edit button for this task and click it
        const editButton = document.querySelector(`.edit-btn[data-id="${taskId}"]`);
        if (editButton) {
            editButton.click();
        }
    });
    
    // ========== ASSIGN FROM VIEW BUTTON ==========
    document.getElementById('assignFromViewBtn').addEventListener('click', function() {
        const viewModal = document.getElementById('viewTaskModal');
        const taskTitle = viewModal.getAttribute('data-task-title');
        
        // Show alert (you can modify this to redirect to assignment page)
        alert(`Redirecting to assign "${taskTitle}" to employees...`);
        
        // In a real implementation, you would:
        // 1. Close the view modal
        // 2. Redirect to the assignment page with the task ID
        // 3. Pre-select this task in the assignment form
    });
    
    // ========== ENHANCE MODAL ANIMATIONS ==========
    const viewModalElement = document.getElementById('viewTaskModal');
    if (viewModalElement) {
        viewModalElement.addEventListener('shown.bs.modal', function() {
            // Add animation classes to elements
            const animatedElements = [
                '.task-description-content',
                '.spec-icon',
                '.info-item',
                '.guideline-item',
                '.stat-card'
            ];
            
            animatedElements.forEach((selector, index) => {
                const elements = this.querySelectorAll(selector);
                elements.forEach((el, elIndex) => {
                    setTimeout(() => {
                        el.style.opacity = '0';
                        el.style.transform = 'translateY(20px)';
                        el.classList.add('animate-in');
                        
                        // Trigger reflow
                        void el.offsetWidth;
                        
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                        el.style.transition = 'all 0.5s ease';
                    }, (index * 100) + (elIndex * 50));
                });
            });
        });
    }
});

// Add CSS for animations
const animationStyles = `
.animate-in {
    animation: fadeInUp 0.5s ease forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-backdrop {
    backdrop-filter: blur(2px);
}
`;

// Add animation styles to document
const styleSheet = document.createElement('style');
styleSheet.textContent = animationStyles;
document.head.appendChild(styleSheet);
</script>