<!-- task_view_modal.html -->
<div class="modal fade" id="viewTaskModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Task Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Task Header -->
                <div class="text-center mb-4">
                    <div class="task-icon-large mx-auto mb-3" id="view_task_icon_container">
                        <i class="fas fa-tasks" id="view_task_icon"></i>
                    </div>
                    <h4 class="mb-2" id="view_task_title"></h4>
                    <div class="d-flex justify-content-center gap-2 mb-3">
                        <span class="badge" id="view_task_priority"></span>
                        <span class="badge bg-light text-dark border" id="view_task_duration_badge"></span>
                    </div>
                </div>
                
                <!-- Task Description -->
                <div class="mb-4">
                    <h6 class="text-muted mb-2 d-flex align-items-center">
                        <i class="fas fa-align-left me-2"></i>Description
                    </h6>
                    <div class="card border-light bg-light">
                        <div class="card-body">
                            <p class="mb-0" id="view_task_description"></p>
                        </div>
                    </div>
                </div>
                
                <!-- Task Details Grid -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center p-3">
                                <div class="mb-2">
                                    <i class="fas fa-clock fa-2x text-primary"></i>
                                </div>
                                <h3 class="text-primary mb-1" id="view_task_duration"></h3>
                                <p class="text-muted small mb-0">Standard Duration</p>
                                <small class="text-muted">(in days)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center p-3">
                                <div class="mb-2">
                                    <i class="fas fa-flag fa-2x" id="view_priority_icon"></i>
                                </div>
                                <h3 class="mb-1" id="view_task_priority_text"></h3>
                                <p class="text-muted small mb-0">Priority Level</p>
                                <small class="text-muted" id="view_priority_help"></small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Info -->
                <div class="mt-4 pt-3 border-top">
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Task Definition Template
                                    </small>
                                </div>
                                <div>
                                    <small class="text-muted" id="view_task_id"></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editFromViewBtn">
                    <i class="fas fa-edit me-1"></i>Edit Task
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.task-icon-large {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.card {
    border-radius: 10px;
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-2px);
}
.badge {
    font-size: 0.75rem;
    padding: 0.5em 1em;
    border-radius: 20px;
    font-weight: 500;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Store task data for edit button
    let currentTaskData = {};
    
    // ========== VIEW BUTTON FUNCTIONALITY ==========
    document.querySelectorAll('.view-btn').forEach(button => {
        button.addEventListener('click', function() {
            const taskId = this.getAttribute('data-id');
            const taskTitle = this.getAttribute('data-title');
            const taskDescription = this.getAttribute('data-description');
            const taskDuration = this.getAttribute('data-duration');
            const taskPriority = this.getAttribute('data-priority');
            
            console.log('View button clicked:', {taskId, taskTitle, taskDescription, taskDuration, taskPriority});
            
            // Store data for edit button
            currentTaskData = {
                id: taskId,
                title: taskTitle,
                description: taskDescription,
                duration: taskDuration,
                priority: taskPriority
            };
            
            // Populate the view modal with task data
            document.getElementById('view_task_title').textContent = taskTitle;
            document.getElementById('view_task_description').textContent = 
                taskDescription || 'No description provided.';
            
            // Duration
            document.getElementById('view_task_duration').textContent = taskDuration;
            document.getElementById('view_task_duration_badge').textContent = 
                `${taskDuration} day${taskDuration != 1 ? 's' : ''}`;
            
            // Priority settings
            let priorityText, priorityClass, priorityIcon, priorityHelp;
            switch(taskPriority) {
                case 'high':
                    priorityText = 'High';
                    priorityClass = 'bg-danger';
                    priorityIcon = 'fas fa-exclamation-circle text-danger';
                    priorityHelp = 'Urgent attention required';
                    document.getElementById('view_task_icon_container').style.background = 
                        'linear-gradient(135deg, #f56565 0%, #c53030 100%)';
                    break;
                case 'medium':
                    priorityText = 'Medium';
                    priorityClass = 'bg-warning';
                    priorityIcon = 'fas fa-exclamation-triangle text-warning';
                    priorityHelp = 'Important but not urgent';
                    document.getElementById('view_task_icon_container').style.background = 
                        'linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)';
                    break;
                case 'low':
                    priorityText = 'Low';
                    priorityClass = 'bg-success';
                    priorityIcon = 'fas fa-check-circle text-success';
                    priorityHelp = 'Normal priority';
                    document.getElementById('view_task_icon_container').style.background = 
                        'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                    break;
                default:
                    priorityText = 'Unknown';
                    priorityClass = 'bg-secondary';
                    priorityIcon = 'fas fa-question-circle text-secondary';
                    priorityHelp = 'Priority not set';
            }
            
            // Set priority elements
            const priorityBadge = document.getElementById('view_task_priority');
            if (priorityBadge) {
                priorityBadge.textContent = priorityText;
                priorityBadge.className = `badge ${priorityClass}`;
            }
            
            const priorityTextElement = document.getElementById('view_task_priority_text');
            if (priorityTextElement) {
                priorityTextElement.textContent = priorityText;
                priorityTextElement.className = priorityClass.replace('bg-', 'text-');
            }
            
            const priorityIconElement = document.getElementById('view_priority_icon');
            if (priorityIconElement) {
                priorityIconElement.className = priorityIcon;
            }
            
            const priorityHelpElement = document.getElementById('view_priority_help');
            if (priorityHelpElement) {
                priorityHelpElement.textContent = priorityHelp;
            }
            
            // Task ID
            const taskIdElement = document.getElementById('view_task_id');
            if (taskIdElement) {
                taskIdElement.textContent = `ID: ${taskId}`;
            }
        });
    });
    
    // ========== EDIT FROM VIEW BUTTON ==========
    const editFromViewBtn = document.getElementById('editFromViewBtn');
    if (editFromViewBtn) {
        editFromViewBtn.addEventListener('click', function() {
            // Close view modal
            const viewModal = bootstrap.Modal.getInstance(document.getElementById('viewTaskModal'));
            if (viewModal) {
                viewModal.hide();
            }
            
            // Populate edit modal with current task data
            setTimeout(() => {
                if (currentTaskData.id) {
                    const editTaskId = document.getElementById('edit_task_id');
                    const editTitle = document.getElementById('edit_title');
                    const editDescription = document.getElementById('edit_description');
                    const editDuration = document.getElementById('edit_standard_duration_days');
                    const editPriority = document.getElementById('edit_priority');
                    
                    if (editTaskId) editTaskId.value = currentTaskData.id;
                    if (editTitle) editTitle.value = currentTaskData.title;
                    if (editDescription) editDescription.value = currentTaskData.description;
                    if (editDuration) editDuration.value = currentTaskData.duration;
                    if (editPriority) editPriority.value = currentTaskData.priority;
                    
                    // Update form action URL
                    const editForm = document.getElementById('editTaskForm');
                    if (editForm) {
                        editForm.action = `/dashboard/tasks/edit/${currentTaskData.id}/`;
                    }
                    
                    // Show edit modal
                    const editModal = new bootstrap.Modal(document.getElementById('editTaskModal'));
                    editModal.show();
                }
            }, 300);
        });
    }
    
    // ========== MODAL TRANSITIONS ==========
    const viewModalElement = document.getElementById('viewTaskModal');
    if (viewModalElement) {
        viewModalElement.addEventListener('show.bs.modal', function() {
            // Reset icon background
            const iconContainer = document.getElementById('view_task_icon_container');
            if (iconContainer) {
                iconContainer.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }
        });
        
        viewModalElement.addEventListener('hidden.bs.modal', function() {
            // Clear current task data when modal is closed
            currentTaskData = {};
        });
    }
});
</script>